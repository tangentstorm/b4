#+title: The b4i Interactive Interpreter

Interactive assembler, debugger, and shell for B4. Execute assembly mnemonics directly, inspect VM state, and script operations.

* Implementation Comparison

(updated 2025-11-13)

| Feature               | Pascal | Lil | J  | JS | Godot | Level |
|-----------------------+--------+-----+----+----+-------+-------|
| **Core VM State**       |        |     |    |    |       |       |
| ~?d~ (data stack)       | y      | y   | y  | y  | y     |     0 |
| ~?c~ (control stack)    | y      | y   | y  | y  | y     |     0 |
| ~?i~ (IP)               | y      | y   | y  | y  | y     |     0 |
| ~?R~ (register)         | y      | NO  | y  | y  | NO    |     0 |
| ~?100~ (mem dump)       | y      | y   | y  | y  | y     |     0 |
| **VM Control**          |        |     |    |    |       |       |
| ~%q~ (quit)             | y      | y   | y  | y  | y     |     0 |
| ~%s~ (step)             | y      | y   | y  | y  | y     |     0 |
| ~\g~ (go)               | y      | NO  | NO | NO | NO    |     0 |
| ~\f~ (show fwd refs)    | y      | NO  | NO | NO | NO    |     0 |
| ~%C~ (clear)            | y      | y   | y  | y  | y     |     0 |
| ~%R~ (reset VM)         | y      | y   | NO | y  | NO    |     1 |
| **Assembly**            |        |     |    |    |       |       |
| ~:100 AA BB~            | y      | y   | y  | y  | y     |     0 |
| ~:foo ...~              | y      | y   | y  | y  | y     |     0 |
| Calculator mode       | y      | y   | y  | y  | y     |     0 |
| **Enhanced Features**   |        |     |    |    |       |       |
| ~\p~ (print dict)       | y      | NO  | NO | NO | NO    |     1 |
| ~\a <file>~ (assemble)  | y      | NO  | NO | NO | NO    |     1 |
| ~\i <file>~ (interpret) | y      | NO  | NO | NO | NO    |     1 |
| ~\d [path]~ (cd)        | y      | NO  | NO | NO | NO    |     1 |
| String literals ~"..."~ | y      | NO  | NO | y  | NO    |     1 |
| Forward refs ~>label~   | y      | NO  | NO | NO | NO    |     1 |
| Command-line ~-a -i~    | y      | y   | NO | NO | y     |     1 |
| Control flow ~.i .t .e~ | y      | y   | NO | y  | NO    |     1 |
| ~.^~ (linked list)      | y      | y   | NO | NO | NO    |     1 |

*Level 0* features are required for =b4-tests.org= compatibility.
*Level 1* features are optional enhancements, soon to be provided "for free" via =b4i.b4a=.

* Architecture: Two Levels

** Level 0: Basic Interactive Assembler

Implemented in each host language (Pascal, JavaScript, J, etc.). Required for =b4-tests.org=.

*** Core Commands

*VM State:*
- =?d= : Data stack
- =?c= : Control stack
- =?i= : Instruction pointer
- =?R= : Register R value (e.g., =?H=)
- =?100= : Dump 16 bytes at address 0x100

*VM Control:*
- =%q= : Quit
- =%s= : Step (execute one instruction)
- =%g= : Go (run until halt/breakpoint)
- =%C= : Clear/reboot VM

*Assembly:*
- =:100 AA BB CC= : Assemble bytes at address
- =:foo c0 c1 rt= : Define label and assemble
- =:R= : Point register R to current address

*Calculator Mode:*
- Hex numbers: =FF 1234= → pushed to stack
- Chars: ='a 'X= → ASCII values to stack
- Opcodes: =ad sw du= → execute immediately
- =^R= : Invoke code at register R

** Level 1: Enhanced Assembler

Optional features that extend Level 0 functionality.

*Dictionary:*
- =\p= : Print dictionary
- =?name= : Lookup address
- =? @name= : Dereference and dump

*Files:*
- =\d [path]= : Show/change directory
- =\a <file>= : Assemble .b4a file
- =\i <file>= : Interpret .b4i script

*Advanced Assembly:*
- Forward references: =>label=
- Strings: ="text"=, =."counted"=
- Control flow: =.i .t .e .w .f=
- 32-bit literals: =$12345678=

*Command-Line:*
: b4i -a lib.b4a -i script.b4i -q

* Usage

Level 0 communicates via stdin/stdout (testable with =tanco= against =b4-tests.org=).

The B4-native implementation (=bios/b4i.b4a=) can run on any VM by spawning a Level 0 implementation as a child process.
